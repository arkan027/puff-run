<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Puff Run - Soran's Game</title>
<style>
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    background: radial-gradient(circle at center, #000, #111);
    font-family: 'Rubik', sans-serif;
    color: white;
  }
  canvas {
    display: block;
    background: radial-gradient(circle at center, #222, #000);
    width: 100vw;
    height: 100vh;
  }
  #score-display, #level-message, #start-screen, #game-over-screen {
    position: absolute;
    z-index: 10;
    text-align: center;
    width: 100%;
    font-weight: 700;
  }
  #score-display {
    top: 10px; left: 20px;
    font-size: 1.5rem;
    width: auto;
    text-align: left;
  }
  #level-message {
    top: 50px;
    font-size: 2rem;
    pointer-events: none;
  }
  #toggle-sound, #toggle-pause {
    position: absolute;
    top: 10px;
    right: 60px;
    font-size: 1.5rem;
    z-index: 10;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    user-select: none;
  }
  #toggle-pause {
    right: 20px;
  }
  #start-screen, #game-over-screen {
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    z-index: 20;
  }
  button {
    padding: 12px 24px;
    font-size: 1.25rem;
    border: none;
    border-radius: 8px;
    background: #6a0dad;
    color: white;
    cursor: pointer;
    margin-top: 15px;
    transition: background 0.3s;
  }
  button:hover {
    background: #7d3cff;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet" />
</head>
<body>
<canvas id="game-canvas"></canvas>
<div id="score-display">Score: 0</div>
<div id="level-message"></div>
<button id="toggle-sound" title="Toggle Sound">üîä</button>
<button id="toggle-pause" title="Pause/Resume">‚è∏Ô∏è</button>
<div id="start-screen">
  <button id="play-btn">Start Game</button>
</div>
<div id="game-over-screen" style="display:none;">
  <div id="score-display-final"></div>
  <button id="retry-btn">Play Again</button>
</div>

<audio id="bg-music" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2023/03/22/audio_b4bb0fadb8.mp3?filename=techno-race-145141.mp3" type="audio/mpeg" />
</audio>
<audio id="hit-sound" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_792ba4168e.mp3?filename=retro-game-over-21391.mp3" type="audio/mpeg" />
</audio>

<script>
(() => {
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d');
  const bgMusic = document.getElementById('bg-music');
  const hitSound = document.getElementById('hit-sound');
  const soundToggle = document.getElementById('toggle-sound');
  const pauseToggle = document.getElementById('toggle-pause');
  const levelMessage = document.getElementById('level-message');
  const startScreen = document.getElementById('start-screen');
  const gameOverScreen = document.getElementById('game-over-screen');
  const scoreDisplay = document.getElementById('score-display');
  const finalScoreDisplay = document.getElementById('score-display-final');

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  let soundOn = true;
  let paused = false;
  let currentLevel = 0;
  let gameActive = false;
  let score = 0;
  let obstacles = [];
  let stars = [];

  const player = {
    x: canvas.width / 2 - 25,
    y: canvas.height - 100,
    radius: 25,
    speed: 8,
    movingLeft: false,
    movingRight: false,
  };

  for(let i=0; i<150; i++) {
    stars.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      radius: Math.random()*1.5,
      speed: 0.2 + Math.random()*1.5
    });
  }

  soundToggle.onclick = () => {
    soundOn = !soundOn;
    soundToggle.textContent = soundOn ? 'üîä' : 'üîá';
    if(soundOn && gameActive && !paused) bgMusic.play();
    else bgMusic.pause();
  };

  pauseToggle.onclick = () => {
    if(!gameActive) return;
    paused = !paused;
    pauseToggle.textContent = paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
    if(paused) bgMusic.pause();
    else {
      if(soundOn) bgMusic.play();
      requestAnimationFrame(update);
    }
  };

  function showLevelUp(level) {
    levelMessage.textContent = `LEVEL ${level}!`;
    levelMessage.style.display = 'block';
    setTimeout(() => { levelMessage.style.display = 'none'; }, 2000);
  }

  function getObstacleSpeed() {
    const levels = [1000, 2000, 5000, 10000, 20000, 50000];
    const speeds = [8, 10, 12, 14, 16, 18];
    for(let i=levels.length-1; i>=0; i--) {
      if(score >= levels[i]) {
        if(currentLevel !== i+1) {
          currentLevel = i+1;
          showLevelUp(currentLevel);
        }
        return speeds[i];
      }
    }
    return 6;
  }

  function spawnObstacle() {
    const width = 40 + Math.random()*30;
    const x = Math.random()*(canvas.width - width);
    const speed = getObstacleSpeed();
    obstacles.push({x, y: -60, width, height: 20, speed});
  }

  function drawPlayer() {
    const grd = ctx.createRadialGradient(
      player.x + player.radius,
      player.y + player.radius,
      player.radius / 2,
      player.x + player.radius,
      player.y + player.radius,
      player.radius
    );
    grd.addColorStop(0, '#0af');
    grd.addColorStop(1, '#005');
    ctx.fillStyle = grd;
    ctx.beginPath();
    ctx.arc(player.x + player.radius, player.y + player.radius, player.radius, 0, Math.PI*2);
    ctx.fill();
  }

  function drawObstacles() {
    for(const ob of obstacles) {
      const gradient = ctx.createLinearGradient(ob.x, ob.y, ob.x+ob.width, ob.y+ob.height);
      gradient.addColorStop(0, '#6a0dad');     // Deep purple
      gradient.addColorStop(0.5, '#9b30ff');   // Bright purple
      gradient.addColorStop(1, '#4b0082');     // Indigo
      ctx.fillStyle = gradient;
      ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    }
  }

  function drawBackground() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    for(const star of stars) {
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.radius, 0, Math.PI*2);
      ctx.fill();
      star.y += star.speed;
      if(star.y > canvas.height) {
        star.y = 0;
        star.x = Math.random()*canvas.width;
      }
    }
  }

  function update() {
    if(!gameActive || paused) return;
    drawBackground();

    if(Math.random() < 0.02) spawnObstacle();

    for(const ob of obstacles) {
      ob.y += ob.speed;
      if(
        ob.x < player.x + player.radius*2 &&
        ob.x + ob.width > player.x &&
        ob.y < player.y + player.radius*2 &&
        ob.y + ob.height > player.y
      ) {
        if(soundOn) hitSound.play();
        return endGame();
      }
    }
    obstacles = obstacles.filter(o => o.y < canvas.height);

    if(player.movingLeft) player.x -= player.speed;
    if(player.movingRight) player.x += player.speed;
    player.x = Math.max(0, Math.min(canvas.width - player.radius*2, player.x));

    drawPlayer();
    drawObstacles();

    score++;
    scoreDisplay.textContent = `Score: ${score}`;

    requestAnimationFrame(update);
  }

  function startGame() {
    score = 0;
    obstacles = [];
    gameActive = true;
    paused = false;
    currentLevel = 0;
    pauseToggle.textContent = '‚è∏Ô∏è';
    startScreen.style.display = 'none';
    gameOverScreen.style.display = 'none';
    if(soundOn) bgMusic.play();
    requestAnimationFrame(update);
  }

  function endGame() {
    gameActive = false;
    finalScoreDisplay.textContent = `Score: ${score}`;
    gameOverScreen.style.display = 'flex';
    bgMusic.pause();
  }

  document.getElementById('play-btn').onclick = startGame;
  document.getElementById('retry-btn').onclick = startGame;

  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') player.movingLeft = true;
    if(e.key === 'ArrowRight') player.movingRight = true;
  });

  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft') player.movingLeft = false;
    if(e.key === 'ArrowRight') player.movingRight = false;
  });

})();
</script>
</body>
</html>
