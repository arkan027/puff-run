<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puff Run - The Impossible Challenge</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to bottom, #111, #000);
      font-family: 'Rubik', sans-serif;
    }
    canvas {
      display: block;
      background: radial-gradient(circle at center, #222, #000);
    }
    #score-display, #level-message, #start-screen, #game-over-screen {
      position: absolute;
      color: white;
      z-index: 10;
      font-size: 2rem;
      text-align: center;
    }
    #score-display {
      top: 10px;
      left: 20px;
      font-size: 1.5rem;
    }
    #level-message {
      top: 50px;
      width: 100%;
    }
    #toggle-sound, #toggle-pause {
      position: absolute;
      top: 10px;
      right: 60px;
      font-size: 1.5rem;
      z-index: 10;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }
    #toggle-pause {
      right: 20px;
    }
    #start-screen, #game-over-screen {
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      flex-direction: column;
    }
    button {
      padding: 12px 24px;
      font-size: 1.25rem;
      border: none;
      border-radius: 8px;
      background: #0af;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #09c;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet">
</head>
<body>
  <canvas id="game-canvas"></canvas>
  <div id="score-display">Score: 0</div>
  <div id="level-message"></div>
  <button id="toggle-sound">üîä</button>
  <button id="toggle-pause">‚è∏Ô∏è</button>
  <div id="start-screen">
    <button id="play-btn">Start Game</button>
  </div>
  <div id="game-over-screen" style="display: none;">
    <div id="score-display-final"></div>
    <button id="retry-btn">Play Again</button>
  </div>
  <audio id="bg-music" loop>
    <source src="https://cdn.pixabay.com/download/audio/2023/03/22/audio_b4bb0fadb8.mp3?filename=techno-race-145141.mp3" type="audio/mpeg">
  </audio>
  <audio id="hit-sound">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_792ba4168e.mp3?filename=retro-game-over-21391.mp3" type="audio/mpeg">
  </audio>
  <script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const bgMusic = document.getElementById('bg-music');
    const hitSound = document.getElementById('hit-sound');
    const soundToggle = document.getElementById('toggle-sound');
    const pauseToggle = document.getElementById('toggle-pause');
    const levelMessage = document.getElementById('level-message');

    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const scoreDisplay = document.getElementById('score-display');
    const finalScoreDisplay = document.getElementById('score-display-final');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let soundOn = true;
    let paused = false;
    let currentLevel = 0;
    let gameActive = false;
    let score = 0;
    let obstacles = [];
    let stars = [];

    const player = {
      x: canvas.width / 2 - 25,
      y: canvas.height - 100,
      radius: 25,
      color: '#0af',
      speed: 8,
      movingLeft: false,
      movingRight: false
    };

    for (let i = 0; i < 150; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5,
        speed: 0.2 + Math.random() * 1.5
      });
    }

    soundToggle.onclick = () => {
      soundOn = !soundOn;
      soundToggle.textContent = soundOn ? 'üîä' : 'üîá';
      if (!soundOn) bgMusic.pause();
      else if (gameActive) bgMusic.play();
    };

    pauseToggle.onclick = () => {
      paused = !paused;
      pauseToggle.textContent = paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
      if (!paused && gameActive) requestAnimationFrame(update);
    };

    function showLevelUp(level) {
      levelMessage.textContent = `LEVEL ${level}!`;
      levelMessage.style.display = 'block';
      setTimeout(() => levelMessage.style.display = 'none', 2000);
    }

    function getObstacleSpeed() {
      const levels = [1000, 2000, 5000, 10000, 20000, 50000];
      const speeds = [8, 10, 12, 14, 16, 18];
      for (let i = levels.length - 1; i >= 0; i--) {
        if (score >= levels[i]) {
          if (currentLevel !== i + 1) {
            showLevelUp(i + 1);
            currentLevel = i + 1;
          }
          return speeds[i];
        }
      }
      return 6;
    }

    function spawnObstacle() {
      const width = 40 + Math.random() * 30;
      const x = Math.random() * (canvas.width - width);
      const speed = getObstacleSpeed();
      obstacles.push({ x, y: -60, width, height: 20, speed });
    }

    function drawPlayer() {
      const grd = ctx.createRadialGradient(player.x + player.radius, player.y + player.radius, player.radius / 2, player.x + player.radius, player.y + player.radius, player.radius);
      grd.addColorStop(0, '#0af');
      grd.addColorStop(1, '#005');
      ctx.fillStyle = grd;
      ctx.beginPath();
      ctx.arc(player.x + player.radius, player.y + player.radius, player.radius, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawObstacles() {
      for (const ob of obstacles) {
        const gradient = ctx.createLinearGradient(ob.x, ob.y, ob.x + ob.width, ob.y + ob.height);
        gradient.addColorStop(0, '#8A2BE2');
        gradient.addColorStop(0.5, '#BA55D3');
        gradient.addColorStop(1, '#4B0082');
        ctx.fillStyle = gradient;
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
      }
    }

    function drawBackground() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      for (const star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fill();
        star.y += star.speed;
        if (star.y > canvas.height) {
          star.y = 0;
          star.x = Math.random() * canvas.width;
        }
      }
    }

    function update() {
      if (!gameActive || paused) return;
      drawBackground();

      if (Math.random() < 0.02) spawnObstacle();
      for (const ob of obstacles) {
        ob.y += ob.speed;
        if (
          ob.x < player.x + player.radius * 2 &&
          ob.x + ob.width > player.x &&
          ob.y < player.y + player.radius * 2 &&
          ob.y + ob.height > player.y
        ) {
          if (soundOn) hitSound.play();
          return endGame();
        }
      }
      obstacles = obstacles.filter(o => o.y < canvas.height);

      if (player.movingLeft) player.x -= player.speed;
      if (player.movingRight) player.x += player.speed;
      player.x = Math.max(0, Math.min(canvas.width - player.radius * 2, player.x));

      drawPlayer();
      drawObstacles();
      score++;
      scoreDisplay.textContent = `Score: ${score}`;
      requestAnimationFrame(update);
    }

    function startGame() {
      score = 0;
      obstacles = [];
      gameActive = true;
      paused = false;
      currentLevel = 0;
      pauseToggle.textContent = '‚è∏Ô∏è';
      startScreen.style.display = 'none';
      gameOverScreen.style.display = 'none';
      if (soundOn) bgMusic.play();
      requestAnimationFrame(update);
    }

    function endGame() {
      gameActive = false;
      finalScoreDisplay.textContent = `Score: ${score}`;
      gameOverScreen.style.display = 'flex';
      bgMusic.pause();
    }

    document.getElementById('play-btn').onclick = startGame;
    document.getElementById('retry-btn').onclick = startGame;

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') player.movingLeft = true;
      if (e.key === 'ArrowRight') player.movingRight = true;
    });

    document.addEventListener('keyup', e => {
      if (e.key === 'ArrowLeft') player.movingLeft = false;
      if (e.key === 'ArrowRight') player.movingRight = false;
    });
  </script>
</body>
</html>
